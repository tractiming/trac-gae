
{% load static %}

<html lang="en" class="">
    
<head>
    <meta name="description"  content="A Chicago based startup focusing on simplifying the track and field experience." /> 

    {% block facebook_meta %}
    <meta property="og:image" content="http://trac-us.com/images/shoes-video.jpg"/>
    <meta property="og:title" content="TRAC | Timing and Racing Around the Clock "/>
    <meta property="fb:admins" content="804255640" />
    <meta property="og:type"   content="website" /> 
     <meta property="og:site_name" content="Timing and Racing Around the Clock"/>
    <meta property="og:url"    content="http://www.trac-us.com" /> 
    <meta property="og:description" content="A Chicago based startup focusing on simplifying the track and field experience." /> 
    {% endblock %}
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link rel="canonical" href="http://www.trac-us.com"/>
    <link rel="icon" href="{% static "img/favicon.ico" %}" type="image/x-icon">
    
    <link rel="stylesheet" href="{% static "css/login_style.css" %}" />
     <link rel='stylesheet' href="{% static "css/fullcalendar.css" %}" />
     <link rel='stylesheet' href="{% static "css/pushy.css" %}" />
     	<link href="{% static "css/progression.min.css" %}" rel='stylesheet' type='text/css'>
             <link type="text/css" rel="stylesheet" href="{% static "css/jquery.dropdown.css" %}" />

    {% block js_scripts %}
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
   
    <script type="text/javascript" src="{% static "js/papaparse.min.js" %}"></script>

    <script type="text/javascript" src="{% static "js/jquery.dropdown.js" %}"></script>
<script src="{% static "js/moment.min.js" %}"></script>
<script src="{% static "js/fullcalendar.js" %}"></script>
<script type="text/javascript" src="{% static "js/jquery.serializeJSON.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/parsley.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/progression.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/jspdf.debug.js" %}"></script>

<script type="text/javascript" src="{% static "js/pushy.min.js" %}"></script>
<!--Google Analytics-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57985584-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
    <!--<script src="{% static "js/jquery-2.1.1.js" %}"></script>-->


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

		<!-- Custom CSS -->
		<link rel="stylesheet" href="{% static "css/new/main.css" %}" />
		<link rel="stylesheet" href="{% static "css/new/score.css" %}" />



    {% endblock %}

    <title>
        {% block title %}
        Timing and Racing Around the Clock | Chicago
        {% endblock %}
    </title>

    {% block extra_head %}
    {% endblock %}
</head>

<body>
	<nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Project name</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="../navbar/">Default</a></li>
            <li><a href="../navbar-static-top/">Static top</a></li>
            <li class="active"><a href="./">Fixed top <span class="sr-only">(current)</span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<!--
  <div id="bowtruss-header" class="container">
    <a href="#" id="pull"></a>
    <ul>

       <li>
        <a href="/" class="scrollto logo" title="trac">trac</a>
      </li>
       
      <li></li>
      <li></li>
      <li></li>

      
      
               <li>
        <a href="/login" class="scrollto" rel="bg2">Login</a>
        </li>

      <li>
        <a href="/register" class="scrollto" rel="bg3">Register</a>
      </li>
     
      <li>
        <a href="http://www.trac-us.com" class="scrollto" rel="bg3">About</a>
      </li>

      <li>
        <a href="/score" class="scrollto" rel="bg3">Live Results</a>
      </li>

    </ul>
  </div>
-->

  <div class="parallax">
  <div class="modal-animate hide">
    <div class="rotate"></div>

	</div>
  
  <nav class="pushy pushy-left">
    <ul class="menulist">
        
        
    </ul>
	</nav>

	<!-- Site Overlay -->
	<div class="site-overlay"></div>


  	<div id="bg2">  



	  	<div class="content">
			  <!-- Your Content -->
				<div id="container">
	    		<!-- Menu Button -->
	    		<div class="menu-btn">&#9776; Heat Menu</div>



 					<h2> Live Results</h2>

				 	<div class="outer" style="width:100%">
						<div class="names" style="width:20%;display:inline-block;float:left">
				    	<table id="nametable" style="width:100%"><tbody><tr><td>Name</td></tr><tr class="odd"><td>Cameron Levins</td></tr><tr><td>Test Runner4</td></tr><tr class="odd"><td>R 1419</td></tr><tr><td>Avery Dennison</td></tr></tbody></table>

				   	</div>

					 	<div class="inner" style="width:70%;display:inline-block;float:left">
	    				<table id="results" style="width:100%"><tbody><tr><td>Split</td><td>Split</td><td>Split</td><td>Split</td><td>Split</td><td>Split</td></tr><tr class="odd"><td>6</td><td>0</td><td>.</td><td>9</td><td>0</td><td>1</td></tr><tr><td>7</td><td>3</td><td>.</td><td>0</td><td>3</td><td>1</td></tr><tr></tr><tr class="odd"><td>3</td><td>3</td><td>5</td><td>.</td><td>3</td><td>4</td><td>8</td></tr><tr><td>3</td><td>3</td><td>4</td><td>.</td><td>2</td><td>2</td><td>8</td></tr></tbody></table>
	    			</div>

	 					<div class="final" style="width:10%;display:inline-block;">
							<table id="finaltimes" style="width:100%"><tbody><tr><td>Final Time</td></tr><tr class="odd"><td>NaN:NaN</td></tr><tr><td>NaN:NaN</td></tr><tr class="odd"><td>NaN:NaN</td></tr><tr><td>NaN:NaN</td></tr></tbody></table>
						</div>
					</div>

<!--
<div class="outer" style="width:100%">
	 <div class="names" style="width:20%;display:inline-block;float:left">
    <table id="nametable" style="width:100%"></table>

    </div>
 <div class="inner" style="width:70%;display:inline-block;float:left">
	


    <table id="results" style="width:100%"></table>
    </div>
 <div class="final" style="width:10%;display:inline-block;">
	


    <table id="finaltimes" style="width:100%"></table>

    </div>
</div>
-->

			    <div id="notifications">
			        <h6 class="notification notification-default" role="alert">There is currently no data for the most recent event.</h6>
			        <h6 class="notification notification-default2" role="alert">No recent events to show.</h6>

			    </div>
    
					<div class="button-container">
					  <input type="submit" name="" class="gen_btn" id="submit" value="Download" />
					</div>
				</div>


 <script>
var idArray=[];
var selectedID;
        //When DOM loaded we attach click event to button
        $(document).ready(function() {
            //show spinner
	    $(".modal-animate").show();
	    
	    //alert(idjson);
		    
		    
		    
		    
	  var repeated_function = function(idjson){
	    //alert(idjson);
	    var last_url = "/api/score/"+ idjson;
	   // alert(last_url);
                //start ajax request
                $.ajax({
                    url: last_url,
		    
                    //force to handle it as text
                    dataType: "text",
                    success: function(data) {
                        
                        //data downloaded so we call parseJSON function 
                        //and pass downloaded data
                        var json = $.parseJSON(data);
			json = $.parseJSON(json.final_score);
                        //now json variable contains data in json format
                        //let's display a few items
                       // $('#results').html('Date: ' + json.date);
			//$('#results').append('<p> Workout ID: '+ json.workoutID);
			
			//if empty show notification, hide spinner, and show button
			if (json.runners == "") {
			    $(".modal-animate").hide();
			    $("h6.notification.notification-default").show();
			      $("input#submit.gen_btn").show();
			      $('#results').empty();
			      $('#finaltimes').empty();
			$('#nametable').empty();
			}
			else {
			    //hide spinner, show button, show results
			    $("div.inner").show();
			$(".modal-animate").hide();
			$("h6.notification.notification-default").hide();
			  $("input#submit.gen_btn").show();
			$('#results').empty();
			$('#finaltimes').empty();
			$('#nametable').empty();
			for (var i=0; i < json.runners.length; i++) {
			  //print names and enter name array
			  var name = json.runners[i].name;
			  //prints all splits with no nesting
			  //var interval = json.runners[i].interval
			  if (i==0) {
			    $('#nametable').append('<tr><td>Name</td></tr>');
			    $('#nametable').append('<tr class="odd"><td>'+name+'</td></tr>');
			    $('#finaltimes').append('<tr><td>Final Time</td></tr>');
			    $('#results').append('<tr></tr><tr class="odd"></tr>');
			     $('#finaltimes').append('<tr class="odd"></tr>');
			  }
			  else if((i)%2 ==0) {
			    $('#nametable').append('<tr class="odd"><td>'+name+'</td></tr>');
			    $('#results').append('<tr></tr><tr class="odd"></tr>');
			    $('#finaltimes').append('<tr class="odd"></tr>');
			  }
			  else{
			    $('#nametable').append('<tr><td>'+name+'</td></tr>');
			     $('#results').append('<tr></tr>');
			     $('#finaltimes').append('<tr></tr>');
			  }
			  
			  
			  var finaltime = 0;
			  
			  for (var j=0; j < json.runners[i].interval.length; j++) {
			    //iterate over interval to get to nested time arrays
			    var interval = json.runners[i].interval[j];
			    //$('#results').append( "Interval Subset: ")
			    

			    for (var k=0; k < json.runners[i].interval[j].length; k++) {
			      //interate over subarrays and pull out each individually and print
			      var subinterval = json.runners[i].interval[j][k];
			      var min = Math.floor(subinterval/60);
			      var sec = (subinterval-(min*60));
			     // $('#results').append('<td>');
			      //This if statements adds the preceding 0 to any second less than 10
			      $('#results tr:last').append('<td>'+subinterval+'</td>');
			      //if (sec<10) {
				//$('#results tr:last').append('<td>'+ min + ':0'+ sec +'</td>');
			      //}
			      //else
			      //{
			      //$('#results tr:last').append('<td>'+ min + ':'+ sec +'</td>');
			      //}
			      finaltime = finaltime + Number(subinterval);
			      if (i==0) {
				//Puts the word 'split #' on table
				
				$('#results tr:first').append('<td>Split</td>');
			      }
			    }
			    
			    
			  }
			  
			  
			  //alert(finaltime)
			   var minfinal = Math.floor(finaltime/60);
			   var secfinal = (finaltime-(minfinal*60)).toFixed(2);
			   //$('#results').append('<td>');
			   //alert(finaltime);
			   
			   //alert(finaltime.toFixed(2));
			   if (secfinal<10) {
			    $('#finaltimes tbody tr:last').append('<td>'+ minfinal + ':0'+ secfinal +'</td>');
			   }
			   else{
			   $('#finaltimes tbody tr:last').append('<td>'+ minfinal + ':'+ secfinal+'</td>');
			   };

			//$('#finaltimes tr').append('' );
			
			}
			
			}
			
                    }
                });}
		
		
		var lastWorkout = function(){
		$.ajax({
                    url: "/api/score/",
		   
                    //force to handle it as text
                    dataType: "text",
                    success: function(data){
		      var json = $.parseJSON(data);
			//alert(json.length);
			if (json.length==0){ 
				$("h6.notification.notification-default2").show();
				$(".modal-animate").hide();
				}
			else{
				 $("h6.notification.notification-default2").hide();
			var idjson = json[json.length - 1].id;
			
			repeated_function(idjson);
			selectedID = idjson;
			//alert(selectedID);
		}
		    }
		    
	    });
		}
		
		var lastSelected = function(){
		$.ajax({
                    url: "/api/score/",
		    
                    //force to handle it as text
                    dataType: "text",
                    success: function(data){
		      var json = $.parseJSON(data);
			//alert(json.length);
			if (json.length==0){ 
				$("h6.notification.notification-default2").show();
				$(".modal-animate").hide();
				}
			else{
				 $("h6.notification.notification-default2").hide();

			repeated_function(selectedID);

		}
		    }
		    
	    });
		}
		
		var findScores = function(){
		$.ajax({
                    url: "/api/score/",
		   
                    //force to handle it as text
                    dataType: "text",
                    success: function(data){
		      var json = $.parseJSON(data);
			//alert(json.length);
			if (json.length==0){ 
				$("h6.notification.notification-default2").show();
				$(".modal-animate").hide();
				}
			else{
				 $("h6.notification.notification-default2").hide();
				 var Array = [];
				 for (var ii=0; ii < json.length; ii++){
					$('#linkedlist').append('<tr><td>'+json[ii].name+'</td></tr>');
					$('ul.menulist').append('<li><a href="#">'+json[ii].name+'</a></li>');
					Array.push(json[ii].id);
				}
				idArray = Array;
				
		}
		    }
		    
	    });
		}
		

	$("body").on('click', 'ul.menulist li a',function(){
	//alert($(this).html());
	var value = $(this).html();
		console.log( "Index: " + $( "ul.menulist li a" ).index( $(this) ) );
		var indexClicked= $( "ul.menulist li a" ).index( $(this) );
	//alert(idArray);
	//alert(idArray[indexClicked]);
	selectedID = idArray[indexClicked];
	repeated_function(idArray[indexClicked]);


	});
	
	findScores();
		//refresh the view every 5 seconds to update
	    lastWorkout();
	   setInterval(lastSelected ,5000);


//Download to Excel Script

    $('#submit').click(function(){
        $.ajax({
                    url: "/api/score/" + selectedID,
		    
                    //force to handle it as text
                    dataType: "text",
                    success: function(data){
		      var json = $.parseJSON(data);
			//alert(json.length);
			//alert(selectedID)
			//alert(idjson);
			urlfn(selectedID);
			return selectedID;
		    }
		    
	    });
    });
});
	

  
  var urlfn = function(){
    var last_url = "/api/score/"+ selectedID;
    //alert(last_url);
     $.ajax({
                    url: last_url,
		    
                    //force to handle it as text
                    dataType: "text",
                    success: function(data) {
        
        JSONToCSVConvertor(data, "TRAC_Report", true);}});
  }
  
  
function JSONToCSVConvertor(JSONData, ReportTitle, ShowLabel) {
    //Data coming in must be json
    //parse through it
    var json = $.parseJSON(JSONData);
  //now json variable contains data in json format
  //let's display a few items
 // $('#results').html('Date: ' + json.date);
  //$('#results').append('<p> Workout ID: '+ json.workoutID);
  
  
  
    var CSV = '';    
    //Set Report title in first row or line
    
    CSV += ReportTitle + '\r\n\n';



   //Uncomment below when using nested json in production
   json = $.parseJSON(json.final_score);
   
      CSV += 'Heat Name,'+ json.name+'\r\n\n';
      CSV += 'Name \r\n'
	      //iterate into name array
	       for (var i=0; i < json.runners.length; i++) {
		  //print names and enter name array
		  var name = json.runners[i].name; 
		    CSV +=name+',';
		  
		//alert(CSV);
   
   
			for (var j=0; j < json.runners[i].interval.length; j++) {
			    //iterate over interval to get to nested time arrays
			    var interval = json.runners[i].interval[j];

			    for (var k=0; k < json.runners[i].interval[j].length; k++) {
			      //interate over subarrays and pull out each individually and print
			      //do a little math to move from seconds to minutes and seconds
			      var subinterval = json.runners[i].interval[j][k];
			      var min = Math.floor(subinterval/60);
			      var sec = (subinterval-(min*60));
			      	CSV += subinterval+',';
			      //This if statements adds the preceding 0 to any second less than 10
			      //if (sec<10) {
				//CSV += min + ':0'+sec+',';
			      //}
			      //else
			      //{
			      //CSV += min + ':'+sec+',';
			      //}
			      
			    }
			  }
			  //moves to new row on excel spreadsheet
			  CSV += '\r\n'
	       }
   
   //if varaible is empty, alert invalid and return
    if (CSV == '') {        
        alert("Invalid data");
        return;
    }
    
    //Generate a file name
    var fileName = "MyReport_";
    //this will remove the blank-spaces from the title and replace it with an underscore
    fileName += ReportTitle.replace(/ /g,"_");   
    
    //Initialize file format you want csv or xls
    var uri = 'data:text/csv;charset=utf-8,' + escape(CSV);
    
    // Now the little tricky part.
    // you can use either>> window.open(uri);
    // but this will not work in some browsers
    // or you will not get the correct file extension    
    
    //this trick will generate a temp <a /> tag
    var link = document.createElement("a");    
    link.href = uri;
    
    //set the visibility hidden so it will not effect on your web-layout
    link.style = "visibility:hidden";
    link.download = fileName + ".csv";
    
    //this part will append the anchor tag and remove it after automatic click
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
    
    
    
    
    
        </div>
     
      </div>
<!--Footer Addition -->
 <div id="footer2">
    <div class="row">

      <div class="left">
        <img class="footer-img" src={% static "img/trac_small.gif" %} alt="TRAC" aria-hidden="true" >
       
      </div>
      <div class="col-md-3">
              
        <ul class="list-reset">

<a href="https://www.facebook.com/timingracing"><img src={% static "img/facebook.png" %}></a>
           <a href="http://youtu.be/9OxhM_fiHWo"><img src={% static "img/youtube.png" %} width="50px"></a>
              <a href="https://angel.co/timing-and-racing-around-the-clock"><img src={% static "img/angellist.png" %}></a>
       </ul>
      </div>
      <div class="col-md-3">
                <ul class="list-reset">
                    <li><a href="http://www.trac-us.com/#bg3" class="scrollto" rel="bg3">About</a></li>
                    <li><a href="http://www.trac-us.com/#bg4" class="scrollto" rel="bg4">Frequently Asked Questions</a></li>
          <li><a href="mailto:info@trac-us.com">Contact us</a></li>
        </ul>
      </div>

      <div class="col-md-3">
        
        <address>
          Timing and Racing Around the Clock<br>
          1871<br>
          222 W. Merchandise Mart Plaza<br>
          Chicago, IL 60654<br><br>
        </address>
      </div>

    </div>
    
</body>
</html>
